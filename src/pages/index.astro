---
import { getCollection } from 'astro:content';
import BaseHead from '../components/BaseHead.astro';
import Footer from '../components/Footer.astro';
import Header from '../components/Header.astro';
import FormattedDate from '../components/FormattedDate.astro';
import Tags from '../components/Tags.astro';
import { CATEGORIES, SITE_DESCRIPTION, SITE_TITLE, classifyByTags } from '../consts';

const allPosts = (await getCollection('blog')).sort((a, b) => b.data.pubDate.valueOf() - a.data.pubDate.valueOf());
const latestPosts = allPosts.slice(0, 4);
const categoryStats = CATEGORIES.map((c) => ({
	...c,
	count: allPosts.filter((p) => classifyByTags(p.data.tags ?? []).includes(c.key)).length,
}));
---

<!doctype html>
<html lang="zh-CN">
	<head>
		<BaseHead title={SITE_TITLE} description={SITE_DESCRIPTION} />
		<style>
			.hero {margin-bottom:1.2rem;}
			.grid {display:grid; gap:1rem;}
			.category-grid {grid-template-columns: repeat(auto-fit, minmax(180px,1fr));}
			.card {border:1px solid rgb(var(--gray-light)); border-radius:12px; padding:1rem; background:#fff;}
			.card h3{margin:0 0 .4rem;}
			.meta{color:rgb(var(--gray)); font-size:.95rem;}
		</style>
	</head>
	<body>
		<Header />
		<main>
			<section class="hero">
				<h1>ğŸ‘‹ æ¬¢è¿æ¥åˆ°å°ä¸€ä¸€çš„åšå®¢</h1>
				<p>èšç„¦ <strong>AIã€æŠ€æœ¯ã€æ¸¸æˆ</strong> ä¸‰å¤§ä¸»é¢˜ï¼Œè®°å½•çœŸå®å¯å¤ç”¨çš„å®è·µä¸æ€è€ƒã€‚</p>
			</section>

			<section>
				<h2>ğŸ“š åˆ†ç±»å¯¼èˆª</h2>
				<div class="grid category-grid">
					{categoryStats.map((c) => (
						<a class="card" href={`${import.meta.env.BASE_URL}categories/${c.key}/`}>
							<h3>{c.emoji} {c.name}</h3>
							<p class="meta">{c.count} ç¯‡æ–‡ç« </p>
						</a>
					))}
				</div>
			</section>

			<section style="margin-top:2rem;">
				<h2>ğŸ†• æœ€æ–°æ–‡ç« </h2>
				<div class="grid">
					{latestPosts.map((post) => (
						<article class="card">
							<h3><a href={`${import.meta.env.BASE_URL}blog/${post.id}/`}>{post.data.title}</a></h3>
							<p class="meta"><FormattedDate date={post.data.pubDate} /></p>
							<p>{post.data.description}</p>
							<Tags tags={post.data.tags} />
						</article>
					))}
				</div>
			</section>
		</main>
		<Footer />
	</body>
</html>
